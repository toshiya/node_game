<!DOCTYPE html> 
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">  
  </head>
  <body>
    <div id="jairo_info"></ul>
    <div id="touch_info"></div>
  </body>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script type="text/javascript">

    //var url = "localhost:6302/";
    var url = "/";
    var socket = io.connect(url);
    var interval = 50;
    
    socket.on("sendMessageToClient", function (data) {
        if (data.X) {
          $("#jairo_info").empty();
          $("#jairo_info").prepend("X:" + data.X + " Y:" + data.Y + " Z:" + data.Z);
        }
        
        if (data.touch) {
          $("#touch_info").prepend("Touch Event Sent:");
        }
    });

    window.addEventListener("deviceorientation", deviceorientationHandler);
    // ジャイロセンサーの値が変化
    function deviceorientationHandler(event) {
        beta  = event.beta;
        gamma = event.gamma;
        alpha = event.alpha;
    }

    function sendJairoInfo (){
       socket.emit("sendMessageToServer", {X:beta, Y:gamma, Z:alpha});
       setTimeout(sendJairoInfo, interval);
    }

    if (window.navigator.userAgent.toLowerCase().indexOf('iphone') > 0) {
        setTimeout(sendJairoInfo, interval);
    }

    window.document.addEventListener('touchend', function () {
        socket.emit("sendMessageToServer", {touch:1});
    });

  </script>
</html>

